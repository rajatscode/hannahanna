# Hannahanna v0.6: Enhanced Workflows & Advanced Features

**Release Date:** TBD
**Theme:** Interactive workflows, advanced features, performance optimization
**Status:** ğŸš§ IN DEVELOPMENT
**Previous Release:** v0.5 (463/463 tests passing)

---

## Executive Summary

v0.6 builds on v0.5's solid foundation by delivering enhanced user workflows, advanced template and workspace features, improved monitoring, and performance optimizations. This release focuses on power-user features while maintaining backward compatibility.

**Key Principle:** Enhance workflows for power users while keeping the tool accessible to newcomers.

---

## What's In Scope for v0.6

### 1. ğŸ¯ Interactive Mode for `hn add` (High Priority)

**Problem:** Users want guided worktree creation without remembering all flags.

**Solution:** Add `--interactive` flag that guides users through worktree creation.

#### Implementation

```bash
$ hn add --interactive

Welcome to Interactive Worktree Creation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Worktree name: feature-auth
2. Base branch: [current: main] main
3. Create new branch? [Y/n] y
4. Branch name: [feature-auth] feature/auth
5. Use template? [y/N] y
   Available templates:
   [1] microservice
   [2] frontend
   [3] experiment
   Select template [1-3]: 1
6. Enable Docker? [Y/n] y
7. Run post-create hooks? [Y/n] y

Summary:
  Name: feature-auth
  Branch: feature/auth (new)
  Template: microservice
  Docker: enabled
  Hooks: enabled

Create worktree? [Y/n] y

Creating worktree 'feature-auth'...
âœ“ Git worktree created
âœ“ Template applied
âœ“ Docker started (ports: app:3000, postgres:5432)
âœ“ Hooks executed

Done! Switch with: hn switch feature-auth
```

**Features:**
- Guided prompts for all options
- Template selection with descriptions
- Docker configuration
- Preview before creation
- Keyboard navigation (arrow keys, enter, escape)

**Implementation Files:**
- `src/cli/add.rs` - Add `--interactive` flag handling
- `src/interactive/mod.rs` (new) - Interactive prompt system
- `src/interactive/add_wizard.rs` (new) - Add worktree wizard

**Tests:**
- Interactive workflow simulation (10+ tests)
- Template selection
- Docker option handling
- Validation and error cases

**Acceptance Criteria:**
- [ ] `hn add --interactive` launches wizard
- [ ] All creation options available interactively
- [ ] Template selection with descriptions works
- [ ] Docker options configurable
- [ ] Can preview before creating
- [ ] Can cancel at any step (ESC)
- [ ] 10+ tests covering all paths

**Estimated Effort:** 3 days

---

### 2. ğŸ“¦ Template Marketplace Foundation (High Priority)

**Problem:** Users want to share templates but lack easy export/import mechanism.

**Solution:** Template export/import with metadata and validation.

#### `hn templates export <name> <path>`

Export template to shareable package:

```bash
$ hn templates export microservice ./my-template.hnhn

Exporting template 'microservice'...
âœ“ Packed configuration
âœ“ Packed files (12 files, 45 KB)
âœ“ Generated metadata
âœ“ Created package: ./my-template.hnhn

Package ready for sharing!
```

**Package format:** `.hnhn` file (tar.gz with metadata)

```
my-template.hnhn/
â”œâ”€â”€ manifest.yml          # Template metadata
â”œâ”€â”€ config.yml            # .hannahanna.yml content
â”œâ”€â”€ files/                # Template files
â””â”€â”€ README.md            # Template documentation
```

**Manifest structure:**
```yaml
name: microservice
version: 1.0.0
author: user@example.com
description: Backend microservice with Docker
created: 2025-11-12T10:00:00Z
hannahanna_version: ">=0.5.0"
tags:
  - microservice
  - docker
  - postgres
dependencies: []
```

#### `hn templates import <path> [name]`

Import template from package:

```bash
$ hn templates import ./my-template.hnhn

Importing template...
âœ“ Validated package structure
âœ“ Checked hannahanna version compatibility
âœ“ Extracted to .hn-templates/microservice/
âœ“ Validated configuration

Template 'microservice' imported successfully!

Usage: hn add <name> --template microservice
```

**Security:**
- Validate package structure
- Check version compatibility
- Scan for suspicious scripts (warn user)
- Sandboxed extraction

#### `hn templates validate <name>`

Validate template configuration:

```bash
$ hn templates validate microservice

Validating template 'microservice'...
âœ“ Configuration syntax valid
âœ“ All file paths exist
âœ“ Variable references valid
âœ“ Hooks are executable
âœ“ Docker config valid

Template is valid!
```

**Validation checks:**
- YAML syntax
- File existence
- Variable reference validation
- Hook script syntax
- Docker compose validation

#### `hn templates publish <name>` (Foundation Only)

Prepare template for sharing (no central registry yet):

```bash
$ hn templates publish microservice

Preparing template for publication...
âœ“ Validated template
âœ“ Generated checksums
âœ“ Created README template
âœ“ Generated manifest

Next steps:
1. Review .hn-templates/microservice/manifest.yml
2. Export with: hn templates export microservice
3. Share the .hnhn package file
```

**Implementation Files:**
- `src/templates/export.rs` (new, ~200 lines)
- `src/templates/import.rs` (new, ~200 lines)
- `src/templates/validate.rs` (new, ~150 lines)
- `src/templates/package.rs` (new, ~150 lines)
- Update `src/cli/templates.rs` with new commands

**Tests:**
- Export template to package (8+ tests)
- Import template from package
- Validate template structure
- Security validation
- Version compatibility checking
- Corrupt package handling

**Acceptance Criteria:**
- [ ] Export templates to .hnhn packages
- [ ] Import templates from packages
- [ ] Validate template structure
- [ ] Security scanning works
- [ ] Version compatibility checking
- [ ] 15+ tests covering all scenarios

**Estimated Effort:** 4 days

---

### 3. ğŸ“Š Advanced Monitoring & Observability (Medium Priority)

**Problem:** Users want better insights into worktree resource usage and history.

**Solution:** Enhanced stats, history tracking, and monitoring dashboards.

#### Enhanced `hn stats` Command

```bash
$ hn stats feature-api --history

Worktree: feature-api
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Current Status:
  Disk Usage:    2.3 GB (worktree: 1.1 GB, state: 1.2 GB)
  Docker Memory: 512 MB (app: 256 MB, db: 256 MB)
  Docker CPU:    5.2%
  Uptime:        2h 15m
  Last Active:   5 minutes ago

History (last 7 days):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Disk Usage (GB)                                 â”‚
  â”‚ 2.5â”‚                                            â”‚
  â”‚ 2.0â”‚         â•­â”€â”€â”€â”€â”€â”€â•®                          â”‚
  â”‚ 1.5â”‚    â•­â”€â”€â”€â•¯      â•°â”€â”€â”€â•®                      â”‚
  â”‚ 1.0â”‚â”€â”€â”€â•¯               â•°â”€â”€â”€â”€                   â”‚
  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚      Mon  Tue  Wed  Thu  Fri  Sat  Sun         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Top Disk Consumers:
  node_modules/      1.2 GB (shared)
  .hn-state/         1.0 GB
  target/            800 MB
  dist/              300 MB

Activity Log (recent):
  2h ago    Docker started (app, postgres)
  3h ago    Hook executed: post_create
  5h ago    Worktree created
```

#### `hn monitor [--live]`

Real-time monitoring dashboard:

```bash
$ hn monitor --live

Hannahanna Monitoring Dashboard (updated every 5s)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Active Worktrees: 3/10     Total Disk: 8.4 GB / 50 GB
Docker Containers: 6        CPU: 12.3%    Memory: 2.1 GB

NAME             STATUS   DISK    DOCKER   CPU    MEM    UPTIME
feature-auth     ACTIVE   2.3 GB  â—â—â—‹â—‹â—‹    5.2%   512MB  2h 15m
feature-billing  IDLE     1.8 GB  â—â—‹â—‹â—‹â—‹    0.1%   128MB  5d 3h
feature-ui       ACTIVE   4.3 GB  â—â—â—â—‹â—‹    7.1%   1.2GB  1h 42m

Recent Activity:
  [10:15:32] feature-auth: Docker container started
  [10:14:20] feature-ui: Switch to worktree
  [10:10:05] feature-billing: Hook executed
  [10:05:00] feature-auth: Worktree created

Press 'q' to quit, 'r' to refresh
```

**Features:**
- Real-time updates
- Activity log
- Resource usage visualization
- Color-coded status
- Keyboard controls

#### `hn activity [name]`

Show worktree activity history:

```bash
$ hn activity feature-auth --since=7d

Activity Log: feature-auth (last 7 days)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

2025-11-12 10:15:32  Docker started (app, postgres)
2025-11-12 10:14:55  Hook: post_create executed (0.5s)
2025-11-12 10:14:54  Template applied: microservice
2025-11-12 10:14:53  Worktree created from main

2025-11-11 15:30:00  Docker stopped
2025-11-11 14:20:00  Switch to feature-auth
2025-11-11 09:00:00  Docker started

2025-11-10 16:45:00  Integration: merged fix-bug-123
2025-11-10 11:30:00  Hook: post_switch executed (0.2s)

Total events: 9
Docker starts: 2    Hook executions: 3    Integrations: 1
```

**Implementation Files:**
- `src/monitoring/mod.rs` (new, ~300 lines) - Monitoring core
- `src/monitoring/history.rs` (new, ~200 lines) - History tracking
- `src/monitoring/dashboard.rs` (new, ~250 lines) - Live dashboard
- `src/monitoring/metrics.rs` (new, ~150 lines) - Metrics collection
- Update `src/cli/stats.rs` with enhanced features
- `src/cli/monitor.rs` (new, ~200 lines) - Monitor command
- `src/cli/activity.rs` (new, ~150 lines) - Activity command

**Storage:**
- `.hn-state/<worktree>/activity.log` - Activity events
- `.hn-state/<worktree>/metrics.json` - Time-series metrics

**Tests:**
- History tracking (10+ tests)
- Metrics collection
- Live monitoring
- Activity log queries
- Resource usage calculation

**Acceptance Criteria:**
- [ ] Enhanced stats with history
- [ ] Live monitoring dashboard
- [ ] Activity log tracking
- [ ] Resource usage visualization
- [ ] 15+ tests covering all features

**Estimated Effort:** 5 days

---

### 4. ğŸ”— Workspace Collaboration Enhancements (Medium Priority)

**Problem:** Users want to share entire workspace states with teammates.

**Solution:** Enhanced workspace export/import with full context.

#### `hn workspace export <name> <path>`

Export workspace state with full context:

```bash
$ hn workspace export friday-work ./workspace.hnhnw

Exporting workspace 'friday-work'...
âœ“ Captured worktree list (3 worktrees)
âœ“ Captured Docker state
âœ“ Captured port allocations
âœ“ Captured configuration overrides
âœ“ Captured git status (branch, commits)
âœ“ Generated manifest

Workspace exported to: ./workspace.hnhnw (2.3 KB)

Share this file with teammates to reproduce your workspace!
```

**Package contents:**
```yaml
# workspace.hnhnw (YAML format)
name: friday-work
created_at: 2025-11-12T17:30:00Z
hannahanna_version: 0.6.0
repository:
  remote: git@github.com:user/repo.git
  default_branch: main

worktrees:
  - name: feature-auth
    branch: feature/auth
    commit: a1b2c3d
    parent: main
    docker:
      enabled: true
      services: [app, postgres]
      ports: { app: 3000, postgres: 5432 }
    template: microservice
    config_overrides:
      hooks:
        post_create: "npm install && npm run setup"

  - name: feature-billing
    branch: feature/billing
    commit: e4f5g6h
    parent: main
    docker:
      enabled: true
      services: [app, postgres]
      ports: { app: 3001, postgres: 5433 }

current_worktree: feature-auth

notes: |
  Working on authentication and billing features.
  Auth is ready for review, billing needs testing.
```

#### `hn workspace import <path> [--create-worktrees]`

Import workspace state:

```bash
$ hn workspace import ./workspace.hnhnw --create-worktrees

Importing workspace 'friday-work'...
âœ“ Validated workspace manifest
âœ“ Checked repository compatibility
âœ“ Repository: git@github.com:user/repo.git (matches)

Workspace contains 2 worktrees:
  1. feature-auth (feature/auth @ a1b2c3d)
  2. feature-billing (feature/billing @ e4f5g6h)

Create worktrees? [Y/n] y

Creating worktrees...
âœ“ feature-auth created (template: microservice)
âœ“ feature-billing created
âœ“ Docker configured
âœ“ Ports allocated

Workspace restored successfully!

Current: feature-auth
Use: hn switch <name> to navigate
```

**Features:**
- Validate repository compatibility
- Recreate worktrees with exact config
- Restore Docker configuration
- Preserve port allocations (best effort)
- Apply config overrides
- Restore current worktree selection

#### `hn workspace diff <name1> <name2>`

Compare two saved workspaces:

```bash
$ hn workspace diff friday-work monday-work

Workspace Comparison
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

friday-work (3 worktrees)  vs  monday-work (5 worktrees)

Added in monday-work:
  + feature-dashboard
  + hotfix-critical

Removed from friday-work:
  - None

Modified:
  feature-auth:
    Branch: feature/auth (same)
    Commit: a1b2c3d â†’ g7h8i9j (2 commits ahead)
    Docker: 3000:5432 â†’ 3000:5432 (same)

  feature-billing:
    Branch: feature/billing (same)
    Commit: e4f5g6h â†’ k1l2m3n (5 commits ahead)
```

**Implementation Files:**
- Update `src/cli/workspace.rs` with export/import/diff
- `src/workspace/export.rs` (new, ~200 lines) - Export logic
- `src/workspace/import.rs` (new, ~250 lines) - Import logic
- `src/workspace/diff.rs` (new, ~150 lines) - Diff logic

**Tests:**
- Workspace export (8+ tests)
- Workspace import with recreation
- Repository validation
- Diff comparison
- Error handling (missing commits, etc.)

**Acceptance Criteria:**
- [ ] Export workspace with full context
- [ ] Import workspace and recreate worktrees
- [ ] Validate repository compatibility
- [ ] Compare workspaces
- [ ] 12+ tests covering all scenarios

**Estimated Effort:** 4 days

---

### 5. âš¡ Performance Optimization (Medium Priority)

**Problem:** Large repos with many worktrees experience slowdowns.

**Solution:** Enhanced caching, lazy loading, and parallel operations.

#### Registry Caching Enhancements

**Current:** 30s TTL cache (v0.4)
**Enhancement:** Smarter invalidation and persistent cache

```rust
// src/registry/cache.rs (new)

pub struct RegistryCache {
    /// In-memory cache
    memory: Arc<RwLock<HashMap<String, CachedRegistry>>>,

    /// Persistent cache (for faster startup)
    disk_cache: PathBuf,

    /// File watchers for invalidation
    watchers: Vec<FileWatcher>,
}

impl RegistryCache {
    /// Smart invalidation based on filesystem events
    pub fn watch_for_changes(&mut self) -> Result<()>;

    /// Persist cache to disk for next startup
    pub fn persist(&self) -> Result<()>;

    /// Load cache from disk
    pub fn load_persisted() -> Result<Option<RegistryCache>>;
}
```

**Improvements:**
- Persistent cache across sessions
- Filesystem watching for automatic invalidation
- Partial cache updates (only changed worktrees)
- Background cache refresh

#### Parallel Operations

```bash
$ hn each --parallel "git fetch"

Executing in 8 worktrees (4 parallel)...
[1/8] feature-auth      âœ“ (2.3s)
[2/8] feature-billing   âœ“ (1.8s)
[3/8] feature-ui        âœ“ (2.1s)
[4/8] feature-dashboard âœ“ (1.5s)
[5/8] hotfix-critical   âœ“ (1.2s)
[6/8] refactor-db       âœ“ (2.8s)
[7/8] optimize-api      âœ“ (1.9s)
[8/8] test-feature      âœ“ (1.4s)

Completed in 6.5s (vs 15.2s sequential, 2.3x speedup)
```

**Implementation:**
- Use `rayon` for parallel execution
- Configurable parallelism level
- Progress bars with `indicatif`
- Error aggregation

#### Lazy Loading

```rust
// src/core/worktree.rs

pub struct Worktree {
    pub name: String,
    pub path: PathBuf,

    // Lazy-loaded fields
    branch: OnceCell<String>,
    commit: OnceCell<String>,
    docker_status: OnceCell<DockerStatus>,
    disk_usage: OnceCell<u64>,
}

impl Worktree {
    /// Load branch on first access
    pub fn branch(&self) -> Result<&str>;

    /// Load Docker status on demand
    pub fn docker_status(&self) -> Result<&DockerStatus>;
}
```

**Improvements:**
- Load expensive data only when needed
- Cache loaded data
- Async loading for UI responsiveness

#### Benchmark Suite

Add comprehensive benchmarks:

```rust
// benches/benchmarks.rs

use criterion::*;

fn bench_list_worktrees(c: &mut Criterion) {
    let mut group = c.benchmark_group("list");

    for size in [10, 50, 100, 500] {
        group.bench_with_input(
            BenchmarkId::from_parameter(size),
            &size,
            |b, &size| {
                b.iter(|| list_worktrees_with_count(size));
            },
        );
    }

    group.finish();
}

fn bench_fuzzy_matching(c: &mut Criterion) { ... }
fn bench_docker_operations(c: &mut Criterion) { ... }
fn bench_template_application(c: &mut Criterion) { ... }
```

**Performance Targets:**
- List 100 worktrees: < 50ms (current: ~80ms)
- Fuzzy search 1000 worktrees: < 10ms (current: ~15ms)
- Parallel `hn each` on 10 worktrees: 3x+ speedup

**Implementation Files:**
- `src/registry/cache.rs` (new, ~300 lines) - Enhanced caching
- `src/registry/watcher.rs` (new, ~150 lines) - Filesystem watching
- Update `src/cli/each.rs` with parallel execution
- `src/core/lazy.rs` (new, ~100 lines) - Lazy loading helpers
- `benches/benchmarks.rs` (expand, +200 lines)

**Dependencies:**
```toml
rayon = "1.8"           # Parallel execution
indicatif = "0.17"      # Progress bars
notify = "6.1"          # Filesystem watching
criterion = "0.5"       # Benchmarking
```

**Tests:**
- Cache invalidation (8+ tests)
- Parallel execution correctness
- Lazy loading behavior
- Benchmark regression tests

**Acceptance Criteria:**
- [ ] Persistent cache across sessions
- [ ] Filesystem watching for invalidation
- [ ] Parallel execution in `hn each`
- [ ] Lazy loading for expensive operations
- [ ] Meet performance targets
- [ ] Comprehensive benchmark suite
- [ ] 10+ tests

**Estimated Effort:** 5 days

---

### 6. ğŸ·ï¸ Worktree Tagging & Filtering (Low Priority)

**Problem:** Users with many worktrees need better organization.

**Solution:** Tag worktrees and filter by tags.

#### `hn tag <worktree> <tag...>`

Add tags to worktrees:

```bash
$ hn tag feature-auth backend urgent
âœ“ Tagged 'feature-auth' with: backend, urgent

$ hn tag feature-ui frontend
âœ“ Tagged 'feature-ui' with: frontend
```

#### `hn tags list [worktree]`

List tags:

```bash
$ hn tags list

All tags:
  backend (2 worktrees)
  frontend (1 worktree)
  urgent (1 worktree)
  experimental (3 worktrees)

$ hn tags list feature-auth
Tags for 'feature-auth': backend, urgent
```

#### `hn list --tag <tag>`

Filter by tag:

```bash
$ hn list --tag backend

Worktrees tagged 'backend':
NAME             BRANCH           COMMIT   STATUS
feature-auth     feature/auth     a1b2c3d  RUNNING
feature-billing  feature/billing  e4f5g6h  STOPPED
```

#### `hn each --tag <tag> <command>`

Run commands on tagged worktrees:

```bash
$ hn each --tag backend "npm test"

Executing on 2 worktrees (tagged: backend)...
==> feature-auth
    âœ“ Tests passed (245 tests)
==> feature-billing
    âœ“ Tests passed (189 tests)
```

**Storage:**
- `.hn-state/<worktree>/tags.txt` - Tags for each worktree
- `.hn-state/tag-index.json` - Reverse index for fast lookup

**Implementation Files:**
- `src/cli/tag.rs` (new, ~200 lines) - Tag commands
- `src/tags/mod.rs` (new, ~150 lines) - Tag management
- `src/tags/index.rs` (new, ~150 lines) - Tag indexing
- Update `src/cli/list.rs` with --tag filter
- Update `src/cli/each.rs` with --tag filter

**Tests:**
- Tag operations (8+ tests)
- Tag filtering
- Tag persistence
- Multiple tags per worktree

**Acceptance Criteria:**
- [ ] Tag worktrees with multiple tags
- [ ] List tags and tagged worktrees
- [ ] Filter by tags in list/each
- [ ] 8+ tests

**Estimated Effort:** 2 days

---

### 7. ğŸ¨ Configuration Profiles (Low Priority)

**Problem:** Users switch between development/staging/production contexts.

**Solution:** Named configuration profiles.

#### Configuration

```yaml
# .hannahanna.yml

profiles:
  dev:
    docker:
      enabled: true
      services: [app, postgres-dev, redis-dev]
      env:
        NODE_ENV: development
        LOG_LEVEL: debug
    hooks:
      post_create: "npm install"

  staging:
    docker:
      enabled: true
      services: [app, postgres, redis]
      env:
        NODE_ENV: staging
        LOG_LEVEL: info
    hooks:
      post_create: "npm ci && npm run build:staging"

  prod:
    docker:
      enabled: true
      services: [app, postgres, redis, monitoring]
      env:
        NODE_ENV: production
        LOG_LEVEL: warn
    hooks:
      post_create: "npm ci && npm run build:prod"
      pre_remove: "npm run cleanup:prod"
```

#### Usage

```bash
$ hn add feature-x --profile dev
âœ“ Using profile: dev
âœ“ Worktree created with dev configuration

$ hn add hotfix-123 --profile prod
âœ“ Using profile: prod
âœ“ Worktree created with prod configuration

$ hn profile switch feature-x staging
âœ“ Switched 'feature-x' to staging profile
âœ“ Docker restarted with staging config
```

**Implementation Files:**
- `src/config/profiles.rs` (new, ~200 lines) - Profile management
- Update `src/cli/add.rs` with --profile flag
- `src/cli/profile.rs` (new, ~150 lines) - Profile commands

**Tests:**
- Profile application (8+ tests)
- Profile switching
- Profile inheritance

**Acceptance Criteria:**
- [ ] Define profiles in config
- [ ] Apply profiles during creation
- [ ] Switch profiles on existing worktrees
- [ ] 8+ tests

**Estimated Effort:** 2 days

---

### 8. ğŸ”§ Advanced Template Features (Low Priority)

**Problem:** Templates need parameterization and validation.

**Solution:** Template parameters and schema validation.

#### Parameterized Templates

```yaml
# .hn-templates/microservice/.hannahanna.yml

template:
  parameters:
    - name: service_name
      description: "Name of the microservice"
      type: string
      required: true
      default: "my-service"

    - name: database
      description: "Database type"
      type: choice
      choices: [postgres, mysql, mongodb]
      required: true
      default: postgres

    - name: cache
      description: "Enable Redis cache"
      type: boolean
      default: true

    - name: port
      description: "Service port"
      type: integer
      default: 3000
      min: 3000
      max: 9999

docker:
  enabled: true
  services:
    - app
    - "{{database}}"
    - "{% if cache %}redis{% endif %}"
  env:
    SERVICE_NAME: "{{service_name}}"
    PORT: "{{port}}"
    DATABASE_TYPE: "{{database}}"
```

#### Usage

```bash
$ hn add feature-api --template microservice --interactive

Using template: microservice

Template parameters:
1. service_name [my-service]: api-gateway
2. database [postgres]: mongodb
3. cache [true]: true
4. port [3000]: 3001

Creating worktree with parameters:
  service_name: api-gateway
  database: mongodb
  cache: true
  port: 3001

Continue? [Y/n] y
```

**Or via CLI:**

```bash
$ hn add feature-api --template microservice \
    --param service_name=api-gateway \
    --param database=mongodb \
    --param port=3001
```

#### Template Schema Validation

```yaml
# .hn-templates/microservice/schema.yml

name: microservice
version: 1.0.0
schema_version: 1

parameters:
  service_name:
    type: string
    pattern: "^[a-z][a-z0-9-]*$"
    min_length: 3
    max_length: 50

  database:
    type: enum
    values: [postgres, mysql, mongodb]

  cache:
    type: boolean

  port:
    type: integer
    min: 3000
    max: 9999

validation:
  hooks:
    - name: post_create
      must_exist: true
      executable: true

  files:
    - path: docker-compose.yml
      must_exist: true
      format: yaml
```

**Validation:**

```bash
$ hn templates validate microservice

Validating template 'microservice'...
âœ“ Schema valid
âœ“ Parameters valid
âœ“ File references valid
âœ“ Hooks executable
âœ“ Docker config valid

Template is valid!
```

**Implementation Files:**
- `src/templates/parameters.rs` (new, ~250 lines) - Parameter handling
- `src/templates/schema.rs` (new, ~200 lines) - Schema validation
- `src/templates/rendering.rs` (new, ~150 lines) - Template rendering with params
- Update `src/cli/add.rs` with --param flag
- Update `src/cli/templates.rs` with validation

**Tests:**
- Parameter parsing (10+ tests)
- Template rendering with parameters
- Schema validation
- Type checking

**Acceptance Criteria:**
- [ ] Define template parameters
- [ ] Interactive parameter input
- [ ] CLI parameter passing
- [ ] Schema validation
- [ ] 12+ tests

**Estimated Effort:** 3 days

---

### 9. ğŸ“¸ Snapshot & Restore (Low Priority)

**Problem:** Users want to save/restore exact worktree state including uncommitted changes.

**Solution:** Snapshot functionality with git stash and metadata.

#### `hn snapshot create <worktree> [name]`

```bash
$ hn snapshot create feature-auth "before-refactor"

Creating snapshot for 'feature-auth'...
âœ“ Captured git status (3 modified, 1 untracked)
âœ“ Created git stash
âœ“ Captured Docker state
âœ“ Saved configuration

Snapshot 'before-refactor' created!

Restore with: hn snapshot restore feature-auth before-refactor
```

#### `hn snapshot list [worktree]`

```bash
$ hn snapshot list feature-auth

Snapshots for 'feature-auth':
NAME               CREATED              FILES  DOCKER  SIZE
before-refactor    2025-11-12 10:30    4      âœ“       234KB
debug-attempt      2025-11-11 15:20    8      âœ“       512KB
clean-state        2025-11-10 09:00    0      âœ“       45KB
```

#### `hn snapshot restore <worktree> <snapshot>`

```bash
$ hn snapshot restore feature-auth before-refactor

Restoring snapshot 'before-refactor' to 'feature-auth'...

WARNING: This will discard current uncommitted changes!
Current state: 2 modified files, 1 untracked file

Continue? [y/N] y

âœ“ Applied git stash
âœ“ Restored Docker state
âœ“ Applied configuration

Snapshot restored successfully!
```

**Snapshot contents:**
```yaml
# .hn-state/<worktree>/snapshots/<name>/metadata.yml
name: before-refactor
created_at: 2025-11-12T10:30:00Z
worktree: feature-auth
branch: feature/auth
commit: a1b2c3d

git:
  stash_ref: stash@{0}
  modified_files: 3
  untracked_files: 1

docker:
  running: true
  services: [app, postgres]
  ports: { app: 3000, postgres: 5432 }

config_overrides:
  # Any local config changes
```

**Implementation Files:**
- `src/cli/snapshot.rs` (new, ~300 lines) - Snapshot commands
- `src/snapshot/mod.rs` (new, ~250 lines) - Snapshot management
- `src/snapshot/git.rs` (new, ~200 lines) - Git stash integration

**Tests:**
- Snapshot create/restore (8+ tests)
- Handling uncommitted changes
- Docker state preservation
- Multiple snapshots

**Acceptance Criteria:**
- [ ] Create snapshots with uncommitted changes
- [ ] Restore snapshots
- [ ] List snapshots
- [ ] Delete snapshots
- [ ] 10+ tests

**Estimated Effort:** 3 days

---

## Testing Requirements

### Comprehensive Test Coverage

**Target:** 520+ total tests (current: 463)

**New Tests by Feature:**
- Interactive mode: 10 tests
- Template marketplace: 15 tests
- Monitoring: 15 tests
- Workspace collaboration: 12 tests
- Performance: 10 tests
- Tagging: 8 tests
- Profiles: 8 tests
- Advanced templates: 12 tests
- Snapshots: 10 tests

**Total new tests:** ~100 tests
**Expected total:** ~560 tests

### Integration Tests

Each major feature must have end-to-end integration tests:

```rust
#[test]
fn test_interactive_mode_full_flow() {
    // Simulate interactive prompts
    // Verify worktree created correctly
}

#[test]
fn test_template_export_import_cycle() {
    // Export template
    // Import in new location
    // Verify identical
}

#[test]
fn test_workspace_export_import_cycle() {
    // Create worktrees
    // Export workspace
    // Clean up
    // Import workspace
    // Verify recreation
}

#[test]
fn test_parallel_execution_speedup() {
    // Measure sequential execution
    // Measure parallel execution
    // Verify speedup
}
```

### Performance Tests

```rust
#[test]
fn test_list_performance_regression() {
    let worktrees = create_n_worktrees(100);

    let start = Instant::now();
    let list = list_worktrees();
    let duration = start.elapsed();

    assert!(duration < Duration::from_millis(50),
            "List operation too slow: {:?}", duration);
}
```

### Stress Tests

```rust
#[test]
fn stress_many_worktrees() {
    // Create 200 worktrees
    // Verify all operations work
    // Verify performance acceptable
}

#[test]
fn stress_parallel_operations() {
    // 50 worktrees
    // Parallel execution
    // Verify correctness
}
```

---

## Documentation Requirements

### User Documentation

**New Guides:**
- `docs/interactive-mode.md` - Interactive worktree creation
- `docs/templates-advanced.md` - Template marketplace and parameters
- `docs/monitoring.md` - Monitoring and observability
- `docs/workspace-collaboration.md` - Sharing workspaces
- `docs/performance.md` - Performance tuning
- `docs/organization.md` - Tags and profiles

**Updates:**
- Update `README.md` with v0.6 features
- Update `docs/templates.md` with marketplace
- Update `docs/workflows.md` with new patterns

### Migration Guide

**docs/MIGRATING.md** - Update with v0.6 changes:
- No breaking changes (fully backward compatible)
- New features opt-in
- Performance improvements automatic
- New commands available

### Release Notes

**RELEASE_NOTES_v0.6.md:**
- Feature highlights
- New commands
- Performance improvements
- Bug fixes
- Upgrade instructions

---

## Version Strategy

### v0.6.0 (This Release)
- All features listed above
- Full backward compatibility
- No breaking changes
- Opt-in new features

### v0.6.1 (Patch Release)
- Bug fixes
- Performance improvements
- Documentation updates

### v0.7.0 (Future)
- Additional features based on feedback
- Continued refinement

### v1.0.0 (Major Milestone)
- Production stability
- API stabilization
- Breaking changes if needed
- Feature freeze focus

---

## Success Criteria

### Functionality
- [ ] All 9 major features implemented
- [ ] Interactive mode works seamlessly
- [ ] Template marketplace operational
- [ ] Monitoring provides valuable insights
- [ ] Workspace collaboration enables team sharing
- [ ] Performance meets or exceeds targets
- [ ] 560+ tests passing (100% pass rate)

### Quality
- [ ] Zero compiler warnings
- [ ] Zero clippy warnings in production code
- [ ] All new features documented
- [ ] Migration guide updated
- [ ] CHANGELOG.md updated

### Performance
- [ ] No regressions from v0.5
- [ ] List 100 worktrees < 50ms
- [ ] Parallel operations 3x+ speedup
- [ ] Persistent cache works across sessions

### Documentation
- [ ] README.md updated
- [ ] 6 new documentation files
- [ ] All commands documented
- [ ] Migration guide complete
- [ ] Release notes comprehensive

---

## Development Plan

### Phase 1: Core Features (Week 1-2)
**Days 1-3:** Interactive mode
**Days 4-7:** Template marketplace
**Days 8-12:** Enhanced monitoring

**Deliverable:** Core user-facing features complete

### Phase 2: Collaboration & Performance (Week 3)
**Days 13-16:** Workspace collaboration
**Days 17-21:** Performance optimization

**Deliverable:** Collaboration and speed improvements

### Phase 3: Organization Features (Week 4)
**Days 22-23:** Tagging system
**Days 24-25:** Configuration profiles
**Days 26-28:** Advanced templates
**Days 29-31:** Snapshots

**Deliverable:** Organization and power-user features

### Phase 4: Testing & Documentation (Week 5)
**Days 32-35:** Comprehensive testing (100+ new tests)
**Days 36-38:** Documentation
**Days 39-40:** Bug fixes and polish

**Deliverable:** Production-ready v0.6

---

## Risk Assessment

### Low Risk
- âœ… Interactive mode (well-scoped)
- âœ… Tagging system (isolated feature)
- âœ… Configuration profiles (additive)

### Medium Risk
- âš ï¸ Template marketplace (package format, validation)
  - **Mitigation:** Conservative validation, security checks
- âš ï¸ Performance optimization (regression potential)
  - **Mitigation:** Comprehensive benchmarks, regression tests
- âš ï¸ Workspace collaboration (complex state recreation)
  - **Mitigation:** Thorough validation, graceful failures

### High Risk
- âŒ None identified for v0.6 scope

---

## Open Questions

1. **Template marketplace:** Should we build a central registry or keep it decentralized?
   - **Decision:** Decentralized for v0.6, central registry in v0.7+

2. **Monitoring dashboard:** Terminal UI or web-based?
   - **Decision:** Terminal UI for v0.6 (using `ratatui`), web option in v0.7+

3. **Snapshot storage:** Git-based or filesystem?
   - **Decision:** Hybrid (git stash + metadata files)

4. **Performance targets:** Are they realistic?
   - **Decision:** Benchmark first, adjust if needed

---

## Next Steps

1. **Begin Phase 1:** Start with interactive mode implementation
2. **Setup benchmark infrastructure:** Baseline current performance
3. **Create test plan:** Map out all 100+ new tests
4. **Documentation prep:** Create documentation structure

---

**Version:** 0.6.0-planning
**Created:** 2025-11-12
**Author:** Claude (Hannahanna AI Assistant)
**Status:** ğŸ“‹ Planning Complete â†’ Ready for Implementation

**Ready to build ALL of v0.6!** ğŸš€
